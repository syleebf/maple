
# ì´ë²¤íŠ¸ ë³´ìƒ ê´€ë¦¬ ì‹œìŠ¤í…œ

NestJS + MongoDB ê¸°ë°˜ì˜ **ì—­í• ë³„ ë³´ìƒ ì´ë²¤íŠ¸ ê´€ë¦¬ ì‹œìŠ¤í…œ**ì…ë‹ˆë‹¤.  
JWT ì¸ì¦ ë° ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´ë¥¼ í†µí•´ ìœ ì €/ìš´ì˜ì/ê°ì‚¬ì/ê´€ë¦¬ì ê¶Œí•œì— ë”°ë¼ ê¸°ëŠ¥ì„ ë¶„ë¦¬í•©ë‹ˆë‹¤.

---

## ğŸ”§ ê¸°ëŠ¥ ìƒì„¸

### ğŸ›¡ï¸ Gateway Server
- ëª¨ë“  ìš”ì²­ì„ ë°›ì•„ **ë¼ìš°íŒ… ë° ì¸ì¦/ì¸ê°€ ì²˜ë¦¬**
- **JWT ê²€ì¦** ë° **ì—­í• (Role) ê²€ì‚¬**
- NestJSì˜ `@nestjs/passport`, `AuthGuard`, `RolesGuard` ì‚¬ìš©
- ì—­í• ì— ë”°ë¥¸ ì ‘ê·¼ ê¶Œí•œ ë¶„ê¸° ì²˜ë¦¬

### ğŸ” Auth Server
- ìœ ì € ë“±ë¡ / ë¡œê·¸ì¸
- JWT ë°œê¸‰ ë° ê²€ì¦
- ì—­í• (Role) ê´€ë¦¬

| ì—­í•      | ê¶Œí•œ ì„¤ëª…                        |
|----------|---------------------------------|
| USER     | ë³´ìƒ ìš”ì²­ ê°€ëŠ¥                   |
| OPERATOR | ì´ë²¤íŠ¸ ë° ë³´ìƒ ë“±ë¡ ê°€ëŠ¥         |
| AUDITOR  | ë³´ìƒ ì´ë ¥ ì¡°íšŒë§Œ ê°€ëŠ¥            |
| ADMIN    | ëª¨ë“  ê¸°ëŠ¥ ì ‘ê·¼ ê°€ëŠ¥              |

### ğŸ“… Event Server

#### 1. ğŸ“Œ ì´ë²¤íŠ¸ ë“±ë¡ / ì¡°íšŒ
- **ìš´ì˜ì(OPERATOR)** ë˜ëŠ” **ê´€ë¦¬ì(ADMIN)** ê°€ ì´ë²¤íŠ¸ ìƒì„± ê°€ëŠ¥
- ì´ë²¤íŠ¸ ì¡°ê±´: ë¡œê·¸ì¸ 3ì¼ ì—°ì†, ì¹œêµ¬ ì´ˆëŒ€, ë ˆë²¨ ë‹¬ì„± ë“±
- ì •ë³´ í¬í•¨: `event_type`, `condition`, `start_date`, `end_date`, `is_active`
- ì „ì²´ ëª©ë¡ ë° ìƒì„¸ ì¡°íšŒ API ì œê³µ

#### 2. ğŸ ë³´ìƒ ë“±ë¡ / ì¡°íšŒ
- ì´ë²¤íŠ¸ì— **ë³´ìƒ ì •ë³´ ì¶”ê°€** ê°€ëŠ¥
- ë³´ìƒ ì˜ˆ: í¬ì¸íŠ¸, ì•„ì´í…œ, ì¿ í° ë“± (`item`, `qty` í¬í•¨)
- ê° ë³´ìƒì€ íŠ¹ì • ì´ë²¤íŠ¸ì™€ **ì—°ê²° ê´€ê³„**ë¥¼ ê°€ì§

#### 3. ğŸ™‹ ìœ ì € ë³´ìƒ ìš”ì²­
- ìœ ì €ëŠ” **ë³´ìƒ ìš”ì²­ ê°€ëŠ¥**
- ì‹œìŠ¤í…œì€ **ì¡°ê±´ ì¶©ì¡± ì—¬ë¶€ ê²€ì¦**
- **ì¤‘ë³µ ìš”ì²­ ë°©ì§€**, ìš”ì²­ ê²°ê³¼ ê¸°ë¡ (ì„±ê³µ/ì‹¤íŒ¨ ë“±)

#### 4. ğŸ“œ ë³´ìƒ ìš”ì²­ ë‚´ì—­ ì¡°íšŒ
- ìœ ì €: ë³¸ì¸ ìš”ì²­ ë‚´ì—­ ì¡°íšŒ
- ìš´ì˜ì / ê°ì‚¬ì / ê´€ë¦¬ì: ì „ì²´ ìœ ì € ìš”ì²­ ë‚´ì—­ ì¡°íšŒ
- (ì„ íƒ) í•„í„°ë§ ê¸°ëŠ¥: ì´ë²¤íŠ¸ë³„, ìƒíƒœë³„ ë“±

---

## ğŸ” ì¸ì¦ êµ¬ì¡°

- **JWT ê¸°ë°˜ ì¸ì¦**
- ì¸ì¦ í† í°ì€ ìš”ì²­ í—¤ë”ì˜ `Authorization: Bearer <token>` í˜•ì‹
- ì—­í•  ê¸°ë°˜ ê¶Œí•œ í™•ì¸ì€ `RolesGuard`ë¥¼ í†µí•´ ì²˜ë¦¬

---

## ğŸ§± ì‹œìŠ¤í…œ êµ¬ì¡°

```

myproject/
â”œâ”€â”€ auth-server/       # ì‚¬ìš©ì ì¸ì¦ ë° ì—­í•  ê´€ë¦¬
â”œâ”€â”€ event-server/      # ì´ë²¤íŠ¸ ë° ë³´ìƒ ì²˜ë¦¬ ë¡œì§
â”œâ”€â”€ gateway-server/    # ì¸ì¦ ë° ìš”ì²­ ë¼ìš°íŒ…
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ README.md

````

---

## ğŸš€ ì‹¤í–‰ ë°©ë²• (Docker Compose)

### ğŸ“¦ ì‚¬ì „ ì¤€ë¹„
- Docker & Docker Compose ì„¤ì¹˜

### â–¶ï¸ ì‹¤í–‰

```bash
# ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì—ì„œ ì‹¤í–‰
docker-compose up --build
````

### ğŸŒ ì„œë²„ ì£¼ì†Œ

* Gateway API: `http://localhost:3000`
* Auth Server: `http://localhost:4000`
* Event Server: `http://localhost:5000`
* MongoDB: `mongodb://localhost:27017`

---

## ğŸ“š ì˜ˆì‹œ ì‹œë‚˜ë¦¬ì˜¤

1. **ìš´ì˜ì**ê°€ "ë¡œê·¸ì¸ 3ì¼ ì—°ì†" ì´ë²¤íŠ¸ ìƒì„± (`5/25 ~ 5/30`)

```json
POST /events
{
  "event_type": "consecutive_login",
  "condition": { "days": 3 },
  "start_date": "2025-05-25",
  "end_date": "2025-05-30"
}
```

2. í•´ë‹¹ ì´ë²¤íŠ¸ì— ë³´ìƒ ë“±ë¡ (3000 ìºì‹œ)

```json
POST /events/:id/reward
{
  "item": "cash",
  "qty": 3000
}
```

3. **ìœ ì €**ëŠ” í•´ë‹¹ ì´ë²¤íŠ¸ì— ëŒ€í•´ ë³´ìƒ ìš”ì²­

```json
POST /rewards/request
{
  "event_id": "abc123",
  "user_id": "user456"
}
```

---

## âœ… ê°œë°œ ìŠ¤íƒ

* **Framework**: [NestJS](https://docs.nestjs.com/)
* **Database**: MongoDB
* **Authentication**: JWT + Passport
* **Deployment**: Docker, Docker Compose

---

## API

| EndPoint                    | Method | Detail                      | role     |
|-----------------------------|--------|-----------------------------|----------|
| auth-server/auth/login      | POST   | ë¡œê·¸ì¸                      | ê³µí†µ     |
| auth-server/users/signup    | POST   | íšŒì›ê°€ì…                    | ê³µí†µ     |
| auth-server/users/:username | GET    | ìœ ì € ë³¸ì¸ ì •ë³´ ì¡°íšŒ         | user     |
| event-server/event/create   | POST   | ì´ë²¤íŠ¸ ìƒì„±                 | operator |
| event-server/event/list     | GET    | ì§„í–‰ì¤‘ì¸ ì´ë²¤íŠ¸ ëª©ë¡ ì¡°íšŒ   | ê³µí†µ     |
| event-server/event/:id      | GET    | ì´ë²¤íŠ¸ ìƒì„¸ ì¡°íšŒ            | ê³µí†µ     |
| event-server/reward/create  | POST   | ë³´ìƒ ì„¤ì •                   | operator |
| event-server/reward/total   | GET    | ë³´ìƒ ìš”ì²­ ë‚´ì—­ ì¡°íšŒ(ê´€ë¦¬ì) | auditor  |
| event-server/reward/:id     | GET    | ë³´ìƒ ìš”ì²­ ë‚´ì—­ ì¡°íšŒ(ìœ ì €)   | user     |
| event-server/reward/request | POST   | ìœ ì € ë³´ìƒ ì‹ ì²­              | user     |

---
